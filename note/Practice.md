# NestJS + TypeORM 学習ロードマップ（3週間）  
使用書籍：『Node.jsフレームワーク超入門』  
対象：第6章 NestJS、第5章 TypeORM（必要に応じて）

---

## ✅ Week 1：NestJSの構造とルーティングを理解する

### 📚 学習内容
- Nest CLIでのプロジェクト作成（`nest new`）
- モジュール・コントローラ・サービスの基本構造
- ルーティング（@Controller, @Get, @Param）
- 依存性注入（DI）とデコレーターの役割

### 📝 ToDoリスト
- [x] Nest CLIのインストールとプロジェクト作成
- [x] AppControllerにルーティングを追加（例：`GET /hello`）
- [x] Serviceでデータ生成・加工処理を作成
- [x] `@Param()` を使ったルートパラメータの受け取り

### 🧠 復習問題
1. Nest CLIで新しいプロジェクトを作成するコマンドは？
2. `@Controller()` と `@Get()` の役割は？
3. サービスクラスをコントローラに注入（DI）するにはどう書く？
4. `@Param()` デコレーターは何に使う？

### 復習問題　回答
1. nest new アプリケーション
2. `@Controller()`：app.controller.tsで記述するデコレータ。クラスがコントローラーであることを指定する。\n
   `@Get()`：このメソッドがHTTPプロトコルのGETメソッドによって呼び出されるアクションを示す。
3. `constructor(private readonly appService: AppService) {}` で自動注入される
4. `@param()`：引数がパラメーターであることを指定するもの。

### 🧪 確認用ミニ課題
**課題：`/hello` にアクセスすると「こんにちは、NestJS！」を返すAPIを作成せよ。**
- `HelloController` を作成し、`GET /hello` を追加
- `HelloService` に処理を切り出して注入
- URLパラメータ `:id` を受け取り、条件でレスポンスを変えるルートも作成

---

## ✅ Week 2：TypeORMを使ったDB連携とCRUDの基本

### 📚 学習内容
- TypeORMの導入と設定（SQLiteでOK）
- Entityクラスの作成とマッピング（`@Entity`, `@Column`, etc.）
- Repositoryパターンでデータ操作（`find`, `save`, `remove`）
- Controller経由でデータの登録・取得・削除

### 📝 ToDoリスト
- [X] `@nestjs/typeorm`, `typeorm`, `sqlite3` を導入
- [ ] `User` エンティティの作成（id, name, age など）
- [ ] `GET /users`, `POST /users`, `DELETE /users/:id` を作成
- [ ] サービス層でリポジトリを使ってDB操作を実装

### 🧠 復習問題
1. NestJSでTypeORMを使うために必要なパッケージは？
2. `@Entity()`、`@Column()` の意味と用途は？
3. Repositoryパターンとは何ですか？
4. データベースにレコードを追加・取得する関数は？

### 復習問題　回答
1. `npm install @nestjs/typeorm`
2. `@Entity()`:クラスに付与するデコレーターで、そのクラスが「データベース上のテーブルに対応するエンティティ」であることを宣言します。
   `@Column()`:エンティティクラス内部のプロパティに付与して、そのフィールドが「テーブルのカラム（列）」としてマッピングされることを示します。
3. データベースにアクセスしてエンティティをやり取りするための機能
4. 追加：`insert()`、取得：`getData()`

### 復習問題　添削
| 設問番号 | あなたの回答                                                       | 正しい・改善点                                                                                                       |
| :--: | :----------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------ |
|   1  | `npm install @nestjs/typeorm`                                | **不完全**：`@nestjs/typeorm` に加えて必ず `typeorm` 本体と、利用するDBに応じたドライバー（例：`mysql2` や `pg` など）も必要です。                    |
|   2  | `@Entity()`: エンティティクラスであることを示す。<br>`@Column()`: カラムであることを示す。 | **ほぼ正解**：それぞれ「このクラスがテーブルに対応するエンティティであることを示す」「このフィールドがテーブルのカラムとなることを示す」という意味です。                                |
|   3  | データベースにアクセスしてエンティティをやり取りするための機能                              | **概ね合っている**：より正確には「エンティティとデータベースの永続化処理を抽象化してまとめた層」であり、`find()`, `save()`, `update()`, `delete()` などの操作を提供します。 |
|   4  | 追加：`insert()`<br>取得：`getData()`                              | **誤り**： `getData()` は存在しないメソッドです。 正しくは「追加：`save()`（または `insert()`）」「取得：`find()`（または `findOne()`）」です。          |



### 🧪 確認用ミニ課題
**課題：「ユーザー管理API」を作成せよ**
- `User` エンティティ（`id`, `name`, `age`）を作成
- 以下のエンドポイントを実装：
  - `GET /users`：全ユーザー取得
  - `POST /users`：新規ユーザー追加
  - `DELETE /users/:id`：指定IDの削除
- Postmanで各APIを確認

---

## ✅ Week 3：DTO・バリデーションとエラー処理

### 📚 学習内容
- DTO（Data Transfer Object）でデータ受け取りの型定義
- `class-validator`によるバリデーションの導入
- エラーハンドリング（400, 404）
- `PUT`による更新処理の追加

### 📝 ToDoリスト
- [ ] DTOクラスの作成（`CreateUserDto`, `UpdateUserDto`）
- [ ] `@Body()` + DTO + `ValidationPipe` を適用
- [ ] `PUT /users/:id` の更新処理を作成
- [ ] 存在しないIDに対して404エラーを返すようにする

### 🧠 復習問題
1. DTOとは何をするためのもの？
2. NestJSでバリデーションを行うには何のライブラリが必要？
3. `@IsString()` や `@IsInt()` はどこで使う？
4. 存在しないIDでアクセスされたときの処理はどう書く？

### 復習問題　添削
| 設問番号 | あなたの回答                                                                            | 正しい・改善点                                                                                                                                                                                        |
| :--: | :-------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|   1  | クライアントから送られてくるデータのフィールドと型を定義するためのクラス。エンティティとは異なりあくまで「リクエスト/レスポンスのデータ構造」を保証するために使用 | **正解**：そのとおりです。DTO（Data Transfer Object）はエンティティとは別に、あくまで「リクエスト／レスポンスのデータ構造」を定義して型保証を行うために使用します。                                                                                                |
|   2  | class-validator                                                                   | **不完全**：NestJSでバリデーションを行うには `class-validator` に加えて `class-transformer` も必要です。<br>例：<br>`bash<br>npm install class-validator class-transformer<br>`                                             |
|   3  | `@IsString()`:文字列かチェック　`@IsInt()`:数値型かチェック                                        | **ほぼ正解**：`@IsString()`, `@IsInt()` といったデコレータは、DTOクラスのプロパティに付与して型チェックを行います。<br>例：<br>`ts<br>export class CreateDto {<br>  @IsString()<br>  name: string;<br>  @IsInt()<br>  age: number;<br> }` |
|   4  | `forbidNonWhitelisted`を`true`に設定                                                  | **誤り**：`forbidNonWhitelisted` は余計なプロパティを弾く設定であり、存在しないIDでアクセスされた場合の処理ではありません。<br>該当レコードが見つからないときは、サービスやコントローラ内で `throw new NotFoundException(...)` として404を返す実装が一般的です。                           |



### 復習問題　回答
1. クライアントから送られてくるデータのフィールドと型を定義するためのクラス。エンティティとは異なりあくまで「リクエスト/レスポンスのデータ構造」を保証するために使用
2. class-validator
3. `@IsString()`:文字列かチェック　`@IsInt()`:数値型かチェック
4. `forbidNonWhitelisted`を`true`に設定

### 🧪 確認用ミニ課題
**課題：「ユーザー更新API」を追加し、バリデーションを導入せよ**
- `PUT /users/:id`：ユーザー情報の更新
- DTOと `ValidationPipe` を使って入力値を検証
- エラーハンドリング：ユーザーが存在しない場合は `404` を返す

---

## 🎯 最終目標
NestJSとTypeORMを使って、以下の要素を備えたREST APIを構築できるようにする：

- コントローラ・サービス・エンティティの分離
- GET / POST / PUT / DELETE によるデータ操作
- DTOとバリデーションの導入
- エラーハンドリングとレスポンス設計

